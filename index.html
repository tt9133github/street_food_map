<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>street_food_map</title>
  <link rel="stylesheet" href="./assets/app.css" />
</head>

<body>
  <div class="topbar">
    <input id="q" placeholder="搜索（店名/地址/城市）" />
    <select id="cat"></select>
  </div>

  <div class="layout">
    <div id="map"></div>
    <div class="side" id="list"></div>
  </div>

  <button class="fab" id="fab" title="设置 / 管理 / 日志">⚙️</button>
  <div class="mask" id="mask"></div>
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer-hd">
      <div style="font-weight:700;">设置 / 管理</div>
      <button class="btn" id="close">关闭</button>
    </div>
    <div class="drawer-bd">
      <div class="sec">
        <h3>数据源（Supabase）</h3>
        <div class="small">
          这里请填写 <b>anon public key</b>（可公开）。<br/>
          <span class="warn">不要使用 service_role key</span>（管理员权限，放前端会被盗用）。
        </div>
        <div class="row" style="margin-top:8px;">
          <input id="sbUrl" placeholder="Supabase URL，例如 https://xxxx.supabase.co" />
        </div>
        <div class="row" style="margin-top:8px;">
          <input id="sbAnon" placeholder="Supabase anon public key（eyJ...）" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button class="btn" id="btnSaveCfg">保存配置</button>
          <button class="btn" id="btnReload">重新加载数据（覆盖本地）</button>
        </div>
        <div class="row" style="margin-top:8px;">
          <button class="btn" id="btnUseLocal">使用本地编辑数据</button>
          <span class="pill" id="dataMode">数据：未知</span>
        </div>
        <div class="small" id="sbHint" style="margin-top:8px;"></div>
      </div>

      <div class="sec">
        <h3>高德地图 Key</h3>
        <div class="small">
          为了避免把 Key 写进仓库，这里运行时加载高德 JS API。<br/>
          填入后保存，然后刷新页面即可。
        </div>
        <div class="row" style="margin-top:8px;">
          <input id="amapKey" placeholder="高德 Web JS API Key" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button class="btn" id="btnSaveAmap">保存 Key</button>
          <button class="btn" id="btnReloadMap">重载地图脚本</button>
        </div>
        <div class="small" id="amapHint" style="margin-top:8px;"></div>
      </div>

      <div class="sec" id="secManage">
        <h3>地址管理（新增 / 编辑 / 删除）</h3>
        <div class="small">
          这里的编辑默认写入 <b>本地浏览器存储</b>（localStorage）。<br/>
          你可以用“导出 JSON”把结果复制/下载成 kb.json，然后手动替换仓库静态数据。
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="btn primary" id="btnNew">新增</button>
          <button class="btn" id="btnSaveItem">保存</button>
          <button class="btn" id="btnRelocate">重新定位</button>
          <button class="btn danger" id="btnDelete">删除</button>
        </div>
        <div class="small" id="editHint" style="margin-top:8px;"></div>

        <div class="split" style="margin-top:10px;">
          <div class="row"><input id="fName" placeholder="店名（必填）" /></div>
          <div class="row"><input id="fCategory" placeholder="品类（例如 面 / 中餐）" /></div>
          <div class="row"><input id="fCity" placeholder="城市（例如 成都市）" /></div>
          <div class="row"><input id="fAddress" placeholder="地址（用于定位）" /></div>
          <div class="row" style="gap:8px;">
            <input id="fLng" placeholder="lng 经度（可空，点重新定位可自动填）" />
            <input id="fLat" placeholder="lat 纬度（可空，点重新定位可自动填）" />
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="btn" id="btnExport">导出 JSON（kb.json）</button>
          <button class="btn" id="btnCopyExport">复制 JSON</button>
          <button class="btn danger" id="btnClearLocal">清空本地编辑数据</button>
        </div>

        <div class="row" style="margin-top:10px;">
          <textarea id="exportBox" placeholder="这里会显示导出的 JSON（kb.json 格式）"></textarea>
        </div>
      </div>

      <div class="sec">
        <h3>日志</h3>
        <div class="row" style="margin-bottom:8px;">
          <select id="logLevel">
            <option value="debug">debug</option>
            <option value="info" selected>info</option>
            <option value="warn">warn</option>
            <option value="error">error</option>
          </select>
          <button class="btn" id="btnClearLog">清空</button>
          <button class="btn" id="btnCopyLog">复制</button>
        </div>
        <div class="small">Console 同步输出；这里方便手机端查看。</div>
        <div class="logs" id="logs"></div>
      </div>
    </div>
  </aside>

  <script src="./assets/app.js"></script>
</body>
</html>
